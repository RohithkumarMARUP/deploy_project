version: 2
jobs:
test_regression_model:
working_directory: ~/project
docker:
- image: circleci/python:3.9.7
steps:
- checkout
- run:
name: Install dependencies
command: |
pip install virtualenv
virtualenv external2_venv
. external2_venv/bin/activate
pip install -r packages/regression_model/requirements.txt
chmod +x ./scripts/fetch_kaggle_dataset.sh
./scripts/fetch_kaggle_dataset.sh
- run:
name: Run tests for regression model
command: py.test -vv packages/regression_model/tests
test_ml_api:
working_directory: ~/project
docker:
- image: circleci/python:3.9.7
steps:
- checkout
- run:
name: Install dependencies
command: |
. external2_venv/bin/activate
pip install -r packages/ml_api/requirements.txt
- run:
name: Run tests for ML API
command: py.test -vv packages/ml_api/tests
train_and_upload_regression_model:
working_directory: ~/project
docker:
- image: circleci/python:3.9.7
steps:
- checkout
- run:
name: Setup env
command: |
. external2_venv/bin/activate
pip install -r packages/regression_model/requirements.txt
- run:
name: Train and publish model
command: |
. external2_venv/bin/activate
chmod +x ./scripts/fetch_kaggle_dataset.sh ./scripts/publish_model.sh
./scripts/fetch_kaggle_dataset.sh
PYTHONPATH=./packages/regression_model python3 packages/regression_model/regression_model/train_pipeline.py
./scripts/publish_model.sh ./packages/regression_model/
workflows:
version: 2
test-all:
jobs:
- test_regression_model
- test_ml_api
- train_and_upload_regression_model
- test_ml_api:
requires:
- train_and_upload_regression_model